<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QM Dashboard</title>
    <style>
        :root {
            --sidebar-width: 240px;
            --sidebar-collapsed: 60px;
            --transition: 0.3s;
            --primary: #2c3e50;
            --accent: #3498db;
            --light: #ecf0f1;
            --dark: #34495e;
        }

        * {
            box-sizing: border-box;
        }

        body, html {
            margin: 0;
            height: 100%;
            font-family: sans-serif;
            color: var(--dark);
        }

        #app {
            display: flex;
            height: 100%;
            overflow: hidden;
        }

        /* Sidebar */
        nav {
            width: var(--sidebar-width);
            background: var(--primary);
            color: white;
            display: flex;
            flex-direction: column;
            transition: width var(--transition);
        }

            nav.collapsed {
                width: var(--sidebar-collapsed);
            }

            nav .toggle {
                background: none;
                border: none;
                color: white;
                font-size: 1.2rem;
                padding: 1rem;
                cursor: pointer;
                text-align: right;
            }

            nav ul {
                list-style: none;
                padding: 0;
                margin: 1rem 0;
                flex: 1;
            }

            nav li {
                margin: .5rem 0;
                text-align: center;
            }

            nav button.nav-btn {
                background: none;
                border: none;
                color: white;
                width: 100%;
                padding: .75rem;
                font-size: 1rem;
                cursor: pointer;
                transition: background .2s;
            }

                nav button.nav-btn:hover {
                    background: rgba(255,255,255,0.1);
                }

            nav .signin {
                color: white;
                margin: 1rem;
                padding: .75rem;
                background: none;
                border: 1px solid white;
                border-radius: 4px;
                cursor: pointer;
                transition: background .2s;
            }

                nav .signin:hover {
                    background: rgba(255,255,255,0.1);
                }

            nav.collapsed ul,
            nav.collapsed .signin {
                display: none;
            }


        /* Main */
        main {
            flex: 1;
            background: var(--light);
            padding: 1rem;
            overflow-y: auto;
            position: relative;
        }

        .top-bar {
            display: flex;
            flex-wrap: wrap;
            gap: .5rem;
            align-items: center;
            margin-bottom: 1rem;
        }

            .top-bar input {
                flex: 1;
                padding: .5rem;
                font-size: 1rem;
                border: 1px solid var(--dark);
                border-radius: 4px;
            }

            .top-bar button {
                padding: .5rem 1rem;
                font-size: 1rem;
                border: none;
                border-radius: 4px;
                background: var(--accent);
                color: white;
                cursor: pointer;
                transition: background .2s;
            }

                .top-bar button:hover {
                    background: #2980b9;
                }

        /* Manage sub-menu */
        .manage-menu {
            display: flex;
            gap: .5rem;
            margin-bottom: 1rem;
        }

            .manage-menu button {
                background: #e67e22;
            }

        /* Forms & Tables */
        .add-form, .remove-view, .signin-form {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }

            .add-form label, .signin-form label {
                display: block;
                margin-top: .5rem;
                font-weight: bold;
            }

            .add-form input, .add-form select,
            .signin-form input {
                width: 100%;
                padding: .5rem;
                margin-top: .25rem;
                border: 1px solid #ccc;
                border-radius: 4px;
            }

        .confirm-delete {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: #c0392b;
            color: white;
            border: none;
            padding: .75rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .category-table {
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
            overflow-x: auto;
        }

            .category-table h3 {
                margin: .75rem;
                color: var(--primary);
            }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        th, td {
            padding: .5rem;
            border: 1px solid #ddd;
            text-align: left;
        }

        th {
            background: var(--accent);
            color: white;
        }

        /* Responsive */
        @media (max-width: 600px) {
            nav {
                position: absolute;
                z-index: 10;
                height: 100%;
            }

            main {
                margin-left: var(--sidebar-collapsed);
            }

            .category-table table {
                min-width: 100%;
            }
        }

        .back-btn {
            background: #7f8c8d;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .back-btn:hover {
            background: #95a5a6;
        }

    </style>
</head>
<body>
    <div id="app">
        <nav id="sidebar" class="collapsed">
            <button class="toggle" onclick="toggleSidebar()">☰</button>
            <ul>
                <li><button class="nav-btn" onclick="navigate('inventory')">QM Inventory</button></li>
                <li><button class="nav-btn" onclick="navigate('request')">QM Request Form</button></li>
            </ul>
            <button id="authBtn" class="signin" onclick="handleAuth()">Sign In</button>
        </nav>
        <main id="main"></main>
    </div>

    <script>
        // STATE
        let signedIn = false;
        let currentPage = 'inventory';  // inventory | request | signin
        let showManageMenu = false;
        let manageMode = null;          // 'add' | 'remove' | null

        // ON LOAD
        window.addEventListener('load', render);

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        function navigate(page) {
            currentPage = page;
            showManageMenu = false;
            manageMode = null;

            const sidebar = document.getElementById('sidebar');
            sidebar.classList.add('collapsed');

            render();
        }

        function handleAuth() {
            if (!signedIn) {
                currentPage = 'signin';
            } else {
                // logout
                signedIn = false;
                currentPage = 'inventory';
            }
            showManageMenu = false;
            manageMode = null;

            // Collapse the sidebar after clicking
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.add('collapsed');

            render();
        }

        function render() {
            const main = document.getElementById('main');
            const authBtn = document.getElementById('authBtn');
            authBtn.textContent = signedIn ? 'Logout' : 'Sign In';

            if (currentPage === 'signin') {
                renderSignIn(main);
            } else if (currentPage === 'inventory') {
                renderInventory(main);
            } else {
                main.innerHTML = '<h2>QM Request Form coming soon…</h2>';
            }
        }

        // SIGN IN
        function renderSignIn(container) {
            container.innerHTML = `
            <h2>Sign In</h2>
            <div class="signin-form">
              <label>Username</label>
              <input id="si-user" type="text" />
              <label>Password</label>
              <input id="si-pass" type="password" />
              <button onclick="submitSignIn()">Submit</button>
            </div>`;
        }
        function submitSignIn() {
            const u = document.getElementById('si-user').value;
            const p = document.getElementById('si-pass').value;
            if (u === 'admin' && p === 'admin123') {
                signedIn = true;
                currentPage = 'inventory';
                alert('Signed in successfully!');
            } else {
                alert('Invalid credentials');
            }
            render();
        }

        // INVENTORY
        function renderInventory(container) {
            let html = `
                <div class="top-bar">
                  <input id="searchTxt" placeholder="Search items…" />
                  <button onclick="doSearch()">Search</button>
                  <button onclick="doDownload()">Download</button>
                  ${signedIn ? '<button onclick="toggleManageMenu()">Manage</button>' : ''}
                </div>`;

            // Toggleable Manage submenu
            if (showManageMenu && signedIn) {
                html += `
                <div class="manage-menu">
                  <button onclick="setManage('add')">Add</button>
                  <button onclick="setManage('edit')">Edit</button>
                  <button onclick="setManage('remove')">Remove</button>
                </div>`;
            }

            // Depending on mode
            if (manageMode === 'add') {
                html += renderAddForm();
            } else if (manageMode === 'edit') {
                html += renderEditForm(); // You’ll need to define this if not already
            } else if (manageMode === 'remove') {
                html += renderRemoveView();
            } else {
                html += renderTables(sampleData);
            }

            container.innerHTML = html;
        }

        function toggleManageMenu() {
            showManageMenu = !showManageMenu;
            manageMode = null; // Reset mode when toggling
            renderInventory(document.getElementById('main'));
        }



        function openManageMenu() {
            showManageMenu = true;
            manageMode = null;
            render();
        }
        function closeManage() {
            showManageMenu = false;
            manageMode = null;
            render();
        }
        function setManage(mode) {
            manageMode = mode;
            render();
        }

        // SAMPLE DATA
        const sampleData = [
            { name: 'Resistor', code: 'EL-001', qty: 150, comment: 'OK', category: 'Electronics' },
            { name: 'Capacitor', code: 'EL-002', qty: 80, comment: 'Stock low', category: 'Electronics' },
            { name: 'Bolt M4', code: 'HW-101', qty: 200, comment: 'OK', category: 'Hardware' },
            { name: 'Screwdriver', code: 'HW-102', qty: 40, comment: 'Check', category: 'Hardware' },
            { name: 'Antivirus', code: 'SW-501', qty: 50, comment: 'Licensed', category: 'Software' }
        ];

        // RENDER TABLES
        function renderTables(data) {
            const cats = [...new Set(data.map(i => i.category))];
            return cats.map(cat => {
                const rows = data.filter(i => i.category === cat)
                    .map(i => `
                               <tr>
                                 <td>${i.name}</td>
                                 <td>${i.code}</td>
                                 <td>${i.qty}</td>
                                 <td>${i.comment}</td>
                               </tr>`).join('');
                return `
              <div class="category-table">
                <h3>${cat}</h3>
                <table>
                  <thead><tr>
                    <th>Name</th><th>Code</th><th>Quantity</th><th>Comment</th>
                  </tr></thead>
                  <tbody>${rows}</tbody>
                </table>
              </div>`;
            }).join('');
        }

        // ADD FORM
        function renderAddForm() {
            return `
            <div class="add-form">
              <h3>Add Item</h3>
              <label>Name</label><input id="add-name" />
              <label>Code</label><input id="add-code" />
              <label>Category</label>
              <select id="add-cat">
                ${[...new Set(sampleData.map(i => i.category))].map(c => `<option>${c}</option>`).join('')}
                <option value="">-- New Category --</option>
              </select>
              <label>Quantity</label><input id="add-qty" />
              <label>Comment</label><input id="add-com" />
              <button onclick="submitAdd()">Submit</button>
            </div>`;
        }
        function submitAdd() {
            // wire to Firebase here...
            alert('Item added (mock).');
            showManageMenu = false; manageMode = null;
            render();
        }

        // EDIT VIEW
        function renderEditForm() {
            return `
            <div class="edit-view">
              <h3>Select an item to edit</h3>
              ${renderEditableTables(sampleData)}
            </div>`;
        }
        function renderEditableTables(data) {
            const cats = [...new Set(data.map(i => i.category))];
            let globalIdx = 0;

            return cats.map(cat => {
                const rows = data.filter(i => i.category === cat)
                    .map((item) => {
                        const row = `
                <tr>
                  <td><input type="radio" name="edit-select" onclick="enableEdit(${globalIdx})" /></td>
                  <td><input id="edit-name-${globalIdx}" value="${item.name}" disabled /></td>
                  <td><input id="edit-code-${globalIdx}" value="${item.code}" disabled /></td>
                  <td><input id="edit-qty-${globalIdx}" value="${item.qty}" disabled /></td>
                  <td><input id="edit-com-${globalIdx}" value="${item.comment}" disabled /></td>
                  <td>${item.category}</td>
                  <td><button id="save-btn-${globalIdx}" onclick="saveEdit(${globalIdx}, '${item.id}')" style="display:none;">Save</button></td>
                </tr>`;
                        globalIdx++;
                        return row;
                    }).join('');

                return `
                <div class="category-table">
                  <h3>${cat}</h3>
                  <table>
                    <thead><tr>
                      <th></th><th>Name</th><th>Code</th><th>Quantity</th><th>Comment</th><th>Category</th><th>Action</th>
                    </tr></thead>
                    <tbody>${rows}</tbody>
                  </table>
                </div>`;
            }).join('');
        }

        function enableEdit(selectedIdx) {
            const total = sampleData.length;

            for (let i = 0; i < total; i++) {
                const nameInput = document.getElementById(`edit-name-${i}`);
                const codeInput = document.getElementById(`edit-code-${i}`);
                const qtyInput = document.getElementById(`edit-qty-${i}`);
                const comInput = document.getElementById(`edit-com-${i}`);
                const saveBtn = document.getElementById(`save-btn-${i}`);

                if (nameInput && codeInput && qtyInput && comInput && saveBtn) {
                    const isSelected = i === selectedIdx;
                    nameInput.disabled = !isSelected;
                    codeInput.disabled = !isSelected;
                    qtyInput.disabled = !isSelected;
                    comInput.disabled = !isSelected;
                    saveBtn.style.display = isSelected ? 'inline-block' : 'none';
                }
            }
        }

        function saveEdit(idx, docId) {
            const name = document.getElementById(`edit-name-${idx}`).value;
            const code = document.getElementById(`edit-code-${idx}`).value;
            const qty = parseInt(document.getElementById(`edit-qty-${idx}`).value);
            const comment = document.getElementById(`edit-com-${idx}`).value;

            // Uncomment when Firebase is ready
            /*
            firebase.firestore().collection('Inventory').doc(docId).update({
                name, code, qty, comment
            }).then(() => {
            */
            alert('Item updated successfully (mock).');
            showManageMenu = false;
            manageMode = null;
            render();
            /*
            }).catch(err => {
                console.error('Update failed:', err);
                alert('Failed to update item.');
            });
            */
        }




        // REMOVE VIEW
        function renderRemoveView() {
            return `
            <div class="remove-view">
              <h3>Select items to remove</h3>
              ${renderRemovableTables(sampleData)}
            </div>
            <button class="confirm-delete" onclick="confirmDelete()">Confirm Delete</button>`;
        }
        function renderRemovableTables(data) {
            // identical categories but with checkboxes
            const cats = [...new Set(data.map(i => i.category))];
            return cats.map(cat => {
                const rows = data.filter(i => i.category === cat)
                    .map((i, idx) => `
                               <tr>
                                 <td><input type="checkbox" data-idx="${idx}" /></td>
                                 <td>${i.name}</td>
                                 <td>${i.code}</td>
                                 <td>${i.qty}</td>
                                 <td>${i.comment}</td>
                               </tr>`).join('');
                return `
              <div class="category-table">
                <h3>${cat}</h3>
                <table>
                  <thead><tr>
                    <th></th><th>Name</th><th>Code</th><th>Quantity</th><th>Comment</th>
                  </tr></thead>
                  <tbody>${rows}</tbody>
                </table>
              </div>`;
            }).join('');
        }
        function confirmDelete() {
            // collect checked
            // wire to Firebase deletion here...
            alert('Selected items removed (mock).');
            showManageMenu = false; manageMode = null;
            render();
        }

        // SEARCH & DOWNLOAD
        function doSearch() {
            const kw = document.getElementById('searchTxt').value.toLowerCase();
            const results = sampleData.filter(i => i.name.toLowerCase().includes(kw));

            let html = `
                <h3>Search Results for “${kw}”</h3>
                <button class="back-btn" onclick="exitSearch()" style="margin-bottom: 1rem;">
                  ⬅ Back to Inventory
                </button>
                <div class="category-table">
                  <table>
                    <thead><tr>
                      <th>Name</th><th>Code</th><th>Quantity</th><th>Comment</th><th>Category</th>
                    </tr></thead>
                    <tbody>
                      ${results.map(i => `
                        <tr>
                          <td>${i.name}</td><td>${i.code}</td>
                          <td>${i.qty}</td><td>${i.comment}</td>
                          <td>${i.category}</td>
                        </tr>`).join('')}
                    </tbody>
                  </table>
                </div>`;

            document.getElementById('main').innerHTML = html;
        }

        function exitSearch() {
            manageMode = null;
            showManageMenu = false;
            renderInventory(document.getElementById('main'));
        }

        function doDownload() {
            alert('Generating PDF (mock)…');
            // use jsPDF → landscape A4 → iterate sampleData tables
        }
    </script>
</body>
</html>